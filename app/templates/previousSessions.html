{% extends "navbar.html" %}
{% block title %} Previous Session Data {% endblock %}

{% block content %}
<table>
    <tr>
        <th>Session ID</th>
        <th>Time of Session</th>
        <th>User ID</th>
        <th>Emotions</th>
    </tr>
    {% for session in sessions %}
    <tr>
        <td>{{ session.id }}</td>
        <td>{{ session.time_of_session }}</td>
        <td>{{ session.user_id }}</td>
        <td>
            {% for emotion in session.emotion_data %}
            {{ emotion.emotion_type }} ({{ emotion.emotion_instances }} instances)<br>
            {% endfor %}
        </td>
        <td>
            <canvas id="pieChartCanvas{{ loop.index }}" width="340" height="280"></canvas>
        </td>
    </tr>
    {% endfor %}

    {% for session in session_data %}
    <script>
        var ctx = document.getElementById('pieChartCanvas{{ loop.index }}').getContext('2d');
        var sessionData = {{ session["emotions_count"] | tojson }};

        // Extract the emotion types and their count
        var labels = [];
        var data = [];

        for (var emotion in sessionData) {
            labels.push(emotion);
            data.push(sessionData[emotion]);
        }

        var myPieChart = new Chart(ctx, {
            type: 'pie', 
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: ["blue", "red", "yellow", "orange", "pink", "purple", "green"]
                }]
            },
            options: {
                responsive: true
            },
        });
    </script>
    {% endfor %}
</table>

{% endblock %}